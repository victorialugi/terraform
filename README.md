# Домашнее задание к занятию "13.Системы мониторинга" - `Молоствов Андрей`

### Задание 1

Учитывая описание (платформа HTTP, вычисления с отчетами на диск, ЦПУ интенсивно используется), я бы выделил следующие четыре категории минимальных метрик:

1) Бизнес-метрики (качество сервиса):

*HTTP запросы: Общее количество, по методам (GET/POST), по эндпоинтам.

*HTTP коды ответа: Группировка по классам (2xx, 3xx, 4xx, 5xx), особенно rate ошибок 5xx и 4xx. Это прямой индикатор доступности и корректности работы API.

*Задержка (Latency) запросов: Процентили времени ответа (p50, p95, p99). Показывает, насколько отзывчив сервис для пользователей.

2) Метрики ресурсов (инфраструктура):

*ЦПУ (CPU): Утилизация на ядро и в целом, время ожидания (steal, iowait если есть), load average (CPU la). Это критично, так как вычисления нагружают процессор.

*Оперативная память (RAM): Общее использование, свободная память, использование кэша, процент использования. Позволяет избежать OOM (Out-Of-Memory) убийств процессов.

*Диск (Disk): Свободное место на разделах, где сохраняются отчеты и где работает приложение. I/O утилизация (чтение/запись) и latency. Если отчеты пишутся на диск, его перегрузка может стать узким местом.

*Inodes (иноды): Свободные иноды на диске с отчетами. Если приложение создает множество мелких файлов (отчетов, логов), их может закончиться даже при свободном месте.

3) Метрики приложения (логика работы):

*Количество активных/обрабатываемых вычислительных задач.

*Среднее время генерации отчета.

*Очередь задач (если есть).

4) Метрики доступности:

*Простое «up/down» сервиса по HTTP-проверке (например, запрос на /health).

### Задание 2

1) Доступность (Availability) сервиса: «Сервис доступен 99.9% времени». Измеряется как доля успешных HTTP-запросов от общего числа.

2) Скорость работы (Performance): «95% всех отчетов формируются менее чем за 10 секунд».

3) Качество результатов (Correctness): Можно ввести метрику «количество жалоб на некорректные отчеты» (ручной ввод) или мониторить долю запросов, которые завершились ошибкой логики приложения

4) Нагрузка (Volume): «Мы обрабатываем в среднем 5000 задач в час».

5) Визуализация: Создать единый Service Level Dashboard с понятными виджетами:

* Зеленая/красная лампочка «Сервис доступен».

* График «Время формирования отчета» с целевой линией (например, 10 сек).

* Индикатор «Выполнение SLA за месяц: 99.7%».

* Счетчик «Отчетов сгенерировано сегодня».

Как итог: нужно договориться с менеджером о цифровых целевых показателях (SLO) по доступности, скорости и объему, а затем настроить мониторинг именно под них.

### Задание 3

1) Использование стека ELK/EFK на своих мощностях

2) Отправка логов ошибок напрямую разработчикам

3) Использование облачных «бесплатных» квот

Начать с Sentry для ошибок приложений, а параллельно в тестовом окружении развернуть минимальный стек EFK (Elasticsearch, Fluent Bit, Kibana) для оценки трудозатрат.

### Задание 4

Ошибка в формуле. Если в системе нет 4xx и 5xx, но есть, например, 3xx (редиректы) и возможно 1xx (информационные) коды, то они входят в знаменатель (summ_all_requests), но не являются «успешными» в контексте завершенных пользовательских операций.

### Задание 5

### PULL модель:
* Центр управления знает всех агентов. Легко увидеть, что пропало.

* Центр ходит к агентам. Нужен доступ из сети мониторинга к приложениям.

* Проблемы с сетью (файрволлы, NAT) на стороне центра.

* Центр может стать узким местом. Нужно планировать нагрузку.

* Центр решает, когда опрашивать. Может быть задержка в обнаружении.

* Сложнее. Нужно заранее знать цели.

* При падении центра данные за период простоя теряются.

* Prometheus, Nagios

### PUSH модель:

* Агенты независимы. Центр не знает, кто должен отправить данные.

* Агенты ходят к центру. Можно проще ограничить входящие соединения к центру.

* Проблемы с сетью на стороне агентов.

* Центр принимает данные. Масштабируется проще (через балансировку).

* Агент отправляет данные сразу. Более оперативное оповещение.

* Проще. Новый сервис может сам зарегистрироваться в системе мониторинга.

* Агенты могут буферизовать и отправить данные позже.

* StatsD, Graphite, InfluxDB

### Задание 6

Чистый Push: TICK.

Чистый Pull: Nagios (в базовом виде).

Гибридные: Prometheus, Zabbix, VictoriaMetrics.
